<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Session 3.2 | Intro to R workshop</title>
<meta name="author" content="Emily Nordmann">
<meta name="description" content="8.1 Set-up Open your Workshop project and do the following: Create and save a new R Markdown document named Session 3.2. get rid of the default template text from line 11 onwards. Download the...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 8 Session 3.2 | Intro to R workshop">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/workshop-dataviz/session-3-2.html">
<meta property="og:image" content="https://psyteachr.github.io/workshop-dataviz/images/logos/logo.png">
<meta property="og:description" content="8.1 Set-up Open your Workshop project and do the following: Create and save a new R Markdown document named Session 3.2. get rid of the default template text from line 11 onwards. Download the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Session 3.2 | Intro to R workshop">
<meta name="twitter:description" content="8.1 Set-up Open your Workshop project and do the following: Create and save a new R Markdown document named Session 3.2. get rid of the default template text from line 11 onwards. Download the...">
<meta name="twitter:image" content="https://psyteachr.github.io/workshop-dataviz/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Intro to R workshop</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="installing-r.html"><span class="header-section-number">1</span> Prep: Installing R</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Prep: Intro to R and RStudio</a></li>
<li><a class="" href="session-1-1.html"><span class="header-section-number">3</span> Session 1.1</a></li>
<li><a class="" href="session-1-2.html"><span class="header-section-number">4</span> Session 1.2</a></li>
<li><a class="" href="session-2-1.html"><span class="header-section-number">5</span> Session 2.1</a></li>
<li><a class="" href="session-2-2.html"><span class="header-section-number">6</span> Session 2.2</a></li>
<li><a class="" href="session-3-1.html"><span class="header-section-number">7</span> Session 3.1</a></li>
<li><a class="active" href="session-3-2.html"><span class="header-section-number">8</span> Session 3.2</a></li>
<li><a class="" href="session-4-1.html"><span class="header-section-number">9</span> Session 4.1</a></li>
<li><a class="" href="session-4-2.html"><span class="header-section-number">10</span> Session 4.2</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/template">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="session-3-2" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Session 3.2<a class="anchor" aria-label="anchor" href="#session-3-2"><i class="fas fa-link"></i></a>
</h1>
<div id="set-up-3" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Set-up<a class="anchor" aria-label="anchor" href="#set-up-3"><i class="fas fa-link"></i></a>
</h2>
<p>Open your Workshop project and do the following:</p>
<ul>
<li>Create and save a new R Markdown document named Session 3.2. get rid of the default template text from line 11 onwards.</li>
<li>Download the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheatsheet</a>.</li>
<li>Create a new code chunk and load the tidyverse.</li>
</ul>
</div>
<div id="joins-data" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Loading data<a class="anchor" aria-label="anchor" href="#joins-data"><i class="fas fa-link"></i></a>
</h2>
<p>The data you want to report on or visualise are often in more than one file (or more than one tab of an excel file). You might need to join up participant demographic information with their experimental data, or score questionnaire responses according to a scoring ket.</p>
<p>For this demo, rather than loading in data, we'll create two small data tables from scratch using the <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> function.</p>
<p><code>customers</code> has id, city and postcode for five customers 1-5.</p>
<ul>
<li>
<code>1:5</code> will fill the variable <code>id</code> with all integers between 1 and 5.</li>
<li>
<code>city</code> and <code>code</code> both use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function to enter multiple strings. Note that each entry is contained within its own quotation marks, apart from missing data, which is recorded as <code>NA</code>.</li>
<li>When entering data like this, it's important that the order of each variable matches up. So number 1 will correspond to "Port Ellen" and "PA42 7DU".</li>
</ul>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Ellen"</span>, <span class="st">"Dufftown"</span>, <span class="cn">NA</span>, <span class="st">"Aberlour"</span>, <span class="st">"Tobermory"</span><span class="op">)</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA42 7DU"</span>, <span class="st">"AB55 4DH"</span>, <span class="cn">NA</span>, <span class="st">"AB38 7RY"</span>, <span class="st">"PA75 6NR"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:subject">Table 8.1: </span>Demo customers table.
</caption>
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
<p><code>orders</code> has customer id and the number of items ordered. Some customers from the previous table have no orders, some have more than one order, and some are not in the customer table.</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,
  items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span>, <span class="fl">21</span>, <span class="fl">23</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:orders">Table 8.2: </span>Demo orders table.
</caption>
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="mutating-joins" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Mutating Joins<a class="anchor" aria-label="anchor" href="#mutating-joins"><i class="fas fa-link"></i></a>
</h2>
<p><a class="glossary" target="_blank" title="Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table." href="https://psyteachr.github.io/glossary/m#mutating-joins">Mutating joins</a> act like the <code><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a target="_blank" href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="op">)</span></code> function in that they add new columns to one table based on values in another table.</p>
<p>All the mutating joins have this basic syntax:</p>
<p><code>****_join(x, y, by = NULL, suffix = c(".x", ".y"))</code></p>
<ul>
<li>
<code>x</code> = the first (left) table</li>
<li>
<code>y</code> = the second (right) table</li>
<li>
<code>by</code> = what columns to match on. If you leave this blank, it will match on all columns with the same names in the two tables.</li>
<li>
<code>suffix</code> = if columns have the same name in the two tables, but you aren't joining by them, they get a suffix to make them unambiguous. This defaults to ".x" and ".y", but you can change it to something more meaningful.</li>
</ul>
<div class="info">
<p>You can leave out the <code>by</code> argument if you're matching on all of the columns with the same name, but it's good practice to always specify it so your code is robust to changes in the loaded data.</p>
</div>
<div id="left_join" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> left_join()<a class="anchor" aria-label="anchor" href="#left_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/left_join.png"></div>
</div>
<p>A <code>left_join</code> keeps all the data from the first (left) table and adds anything that matches from the second (right) table. If the right table has more than one match for a row in the left table, there will be more than one row in the joined table (see ids 4 and 5).</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">left_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">left_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="join">
<div class="inline-figure"><img src="images/joins/left_join_rev.png"></div>
</div>
<p>The order you specify the tables matters, in the below code we have reversed the order and so the result is all rows from the <code>orders</code> table joined to any matching rows from the <code>customers</code> table.</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">left2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">left2_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="right_join" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> right_join()<a class="anchor" aria-label="anchor" href="#right_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/right_join.png"></div>
</div>
<p>A <code>right_join</code> keeps all the data from the second (right) table and joins anything that matches from the first (left) table.</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">right_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">right_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>This table has the same information as <code>left_join(orders, customers, by = "id")</code>, but the columns are in a different order (left table, then right table).</p>
</div>
</div>
<div id="inner_join" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> inner_join()<a class="anchor" aria-label="anchor" href="#inner_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/inner_join.png"></div>
</div>
<p>An <code>inner_join</code> returns all the rows that have a match in both tables. Changing the order of the tables will change the order of the columns, but not which rows are kept.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inner_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">inner_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="full_join" class="section level3" number="8.3.4">
<h3>
<span class="header-section-number">8.3.4</span> full_join()<a class="anchor" aria-label="anchor" href="#full_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/full_join.png"></div>
</div>
<p>A <code>full_join</code> lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn't have a match in the other table, the other table's column values are set to <code>NA</code>.</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">full_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">full_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="filtering-joins" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Filtering Joins<a class="anchor" aria-label="anchor" href="#filtering-joins"><i class="fas fa-link"></i></a>
</h2>
<p><a class="glossary" target="_blank" title="Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table." href="https://psyteachr.github.io/glossary/f#filtering-joins">Filtering joins</a> act like the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> function in that they keep and remove rows from the data in one table based on the values in another table. The result of a filtering join will only contain rows from the left table and have the same number or fewer rows than the left table.</p>
<div id="semi_join" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> semi_join()<a class="anchor" aria-label="anchor" href="#semi_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/semi_join.png"></div>
</div>
<p>A <code>semi_join</code> returns all rows from the left table where there are matching values in the right table, keeping just columns from the left table.</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">semi_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">semi_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>Unlike an inner join, a semi join will never duplicate the rows in the left table if there is more than one matching row in the right table.</p>
</div>
<div class="join">
<div class="inline-figure"><img src="images/joins/semi_join_rev.png"></div>
</div>
<p>Order matters in a semi join.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">semi2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">semi2_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="anti_join" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> anti_join()<a class="anchor" aria-label="anchor" href="#anti_join"><i class="fas fa-link"></i></a>
</h3>
<div class="join">
<div class="inline-figure"><img src="images/joins/anti_join.png"></div>
</div>
<p>An <code>anti_join</code> return all rows from the left table where there are <em>not</em> matching values in the right table, keeping just columns from the left table.</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anti_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">anti_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr></tbody>
</table></div>
</div>
<div class="join">
<div class="inline-figure"><img src="images/joins/anti_join_rev.png"></div>
</div>
<p>Order matters in an anti join.</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anti2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">orders</span>, <span class="va">customers</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>
<span class="va">anti2_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id="multiple-joins" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Multiple joins<a class="anchor" aria-label="anchor" href="#multiple-joins"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>****_join()</code> functions are all <strong>two-table verbs</strong>, that is, you can only join together two tables at a time. However, you may often need to join together multiple tables. To do so, you simply need to add on additional joins. You can do this by creating an intermediate object or more efficiently by using a pipe.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a table of overall customer satisfaction scores</span>
<span class="va">satisfaction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  satisfaction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># perform the initial join</span>
<span class="va">join_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>

<span class="co"># perform the second join on the new object</span>
<span class="va">join_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">join_1</span>, <span class="va">satisfaction</span>, 
                    by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># more efficient method using the pipe</span>
<span class="va">pipe_join</span> <span class="op">&lt;-</span> <span class="va">customers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">orders</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">satisfaction</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<div class="warning">
<p>At every stage of any analysis you should <strong>check your output</strong> to ensure that what you created is what you intended to create, but this is particularly true of joins. You should be familiar enough with your data through routine checks using functions like <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>, <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, and <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to have a rough idea of what the join should result in. At the very least, you should know whether the joined object should result in more or fewer variables and observations.</p>
<p>If you have a multi-line join like in the above piped example, build up the code and check the output at each stage.</p>
</div>
</div>
<div id="binding-joins" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Binding Joins<a class="anchor" aria-label="anchor" href="#binding-joins"><i class="fas fa-link"></i></a>
</h2>
<p><a class="glossary" target="_blank" title="Joins that bind one table to another by adding their rows or columns together." href="https://psyteachr.github.io/glossary/b#binding-joins">Binding joins</a> bind one table to another by adding their rows or columns together.</p>
<div id="bind_rows" class="section level3" number="8.6.1">
<h3>
<span class="header-section-number">8.6.1</span> bind_rows()<a class="anchor" aria-label="anchor" href="#bind_rows"><i class="fas fa-link"></i></a>
</h3>
<p>You can combine the rows of two tables with <code>bind_rows</code>.</p>
<p>Here we'll add customer data for customers 6-9 and bind that to the original customer table.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">9</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">bindr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span>
<span class="va">bindr_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The columns just have to have the same names, they don't have to be in the same order. Any columns that differ between the two tables will just have <code>NA</code> values for entries from the other table.</p>
<p>If a row is duplicated between the two tables (like id 5 below), the row will also be duplicated in the resulting table. If your tables have the exact same columns, you can use <code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> (see Section <a href="session-3-2.html#union">8.7.2</a>) to avoid duplicates.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>,
  new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">bindr2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span>
<span class="va">bindr2_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:right;">
new
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
<td style="text-align:right;">
5
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="bind_cols" class="section level3" number="8.6.2">
<h3>
<span class="header-section-number">8.6.2</span> bind_cols()<a class="anchor" aria-label="anchor" href="#bind_cols"><i class="fas fa-link"></i></a>
</h3>
<p>You can merge two tables with the same number of rows using <code>bind_cols</code>. This is only useful if the two tables have the same number of rows in the exact same order.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">bindc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_info</span><span class="op">)</span>
<span class="va">bindc_data</span> </code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:left;">
colour
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
<td style="text-align:left;">
red
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
<td style="text-align:left;">
orange
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
yellow
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
<td style="text-align:left;">
green
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:left;">
blue
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="info">
<p>The only advantage of <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> over a mutating join is when the tables don't have any IDs to join by and you have to rely solely on their order. Otherwise, you should use a mutating join (all four mutating joins result in the same output when all rows in each table have exactly one match in the other table).</p>
</div>
</div>
</div>
<div id="set-operations" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Set Operations<a class="anchor" aria-label="anchor" href="#set-operations"><i class="fas fa-link"></i></a>
</h2>
<p><a class="glossary" target="_blank" title="Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff)." href="https://psyteachr.github.io/glossary/s#set-operations">Set operations</a> compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).</p>
<div id="intersect" class="section level3" number="8.7.1">
<h3>
<span class="header-section-number">8.7.1</span> intersect()<a class="anchor" aria-label="anchor" href="#intersect"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::intersect()</a></code> returns all rows in two tables that match exactly. The columns don't have to be in the same order, but they have to have the same names.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">intersect_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">intersect</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span>
<span class="va">intersect_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr></tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages." href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::intersect()</a></code> function that doesn't work like <code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::intersect()</a></code>. The error message can be confusing and looks something like this:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<pre><code>## Error:
## ! Must subset rows with a valid subscript vector.
## i Logical subscripts must match the size of the indexed input.
## x Input has size 5 but subscript `!duplicated(x, fromLast = fromLast, ...)` has size 0.</code></pre>
</div>
</div>
<div id="union" class="section level3" number="8.7.2">
<h3>
<span class="header-section-number">8.7.2</span> union()<a class="anchor" aria-label="anchor" href="#union"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::union()</a></code> returns all the rows from both tables, removing duplicate rows, unlike <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code>.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">union_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">union</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span>
<span class="va">union_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Falkirk
</td>
<td style="text-align:left;">
FK1 4RS
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Ardbeg
</td>
<td style="text-align:left;">
PA42 7EA
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Doogal
</td>
<td style="text-align:left;">
G81 4SJ
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Kirkwall
</td>
<td style="text-align:left;">
KW15 1SE
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages." href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::union()</a></code> function. You usually won't get an error message, but the output won't be what you expect.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 3 4 5
## 
## [[2]]
## [1] "Port Ellen" "Dufftown"   NA           "Aberlour"   "Tobermory" 
## 
## [[3]]
## [1] "PA42 7DU" "AB55 4DH" NA         "AB38 7RY" "PA75 6NR"
## 
## [[4]]
## [1] 5 6 7 8 9
## 
## [[5]]
## [1] "PA75 6NR" "FK1 4RS"  "PA42 7EA" "G81 4SJ"  "KW15 1SE"
## 
## [[6]]
## [1] "Tobermory" "Falkirk"   "Ardbeg"    "Doogal"    "Kirkwall"</code></pre>
</div>
</div>
<div id="setdiff" class="section level3" number="8.7.3">
<h3>
<span class="header-section-number">8.7.3</span> setdiff()<a class="anchor" aria-label="anchor" href="#setdiff"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::setdiff</a></code> returns rows that are in the first table, but not in the second table.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setdiff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span>
<span class="va">setdiff_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Order matters for <code>setdiff</code>.</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setdiff2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">new_customers</span>, <span class="va">customers</span><span class="op">)</span>
<span class="va">setdiff2_data</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:left;">
city
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:left;">
Falkirk
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:left;">
Ardbeg
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
G81 4SJ
</td>
<td style="text-align:left;">
Doogal
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
KW15 1SE
</td>
<td style="text-align:left;">
Kirkwall
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="warning">
<p>If you've forgotten to load dplyr or the tidyverse, <a class="glossary" target="_blank" title="The set of R functions that come with a basic installation of R, before you add external packages." href="https://psyteachr.github.io/glossary/b#base-r">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::setdiff()</a></code> function. You usually won't get an error message, but the output might not be what you expect because <code><a href="https://rdrr.io/r/base/sets.html">base::setdiff()</a></code> expects columns to be in the same order, so id 5 here registers as different between the two tables.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
city
</th>
<th style="text-align:left;">
postcode
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Port Ellen
</td>
<td style="text-align:left;">
PA42 7DU
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Dufftown
</td>
<td style="text-align:left;">
AB55 4DH
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Aberlour
</td>
<td style="text-align:left;">
AB38 7RY
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Tobermory
</td>
<td style="text-align:left;">
PA75 6NR
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>
<div id="conflicting-variable-types" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Conflicting variable types<a class="anchor" aria-label="anchor" href="#conflicting-variable-types"><i class="fas fa-link"></i></a>
</h2>
<p>When you import or create data, R will do its best to set each column to an appropriate data type. However, sometimes it gets it wrong or sometimes there's something in the way the data has been encoded in the original spreadsheet that causes the data type to be different than expected. When joining datasets by common columns, it's important that not only are the variable names identical, but the data type of those variables is identical.</p>
<p>Let's recreate our <code>new_customers</code> dataset but this time, we'll specify that <code>id</code> is a <a class="glossary" target="_blank" title="A data type representing strings of text." href="https://psyteachr.github.io/glossary/c#character">character</a> variable.</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,
  postcode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span><span class="op">)</span>,
  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">new_customers2</span><span class="op">)</span></code></pre></div>
<pre><code>## tibble [5 x 3] (S3: tbl_df/tbl/data.frame)
##  $ id      : chr [1:5] "5" "6" "7" "8" ...
##  $ postcode: chr [1:5] "PA75 6NR" "FK1 4RS" "PA42 7EA" "G81 4SJ" ...
##  $ city    : chr [1:5] "Tobermory" "Falkirk" "Ardbeg" "Doogal" ...</code></pre>
<p>If you try to join this dataset to any of the other datasets where <code>id</code> is stored as a <a class="glossary" target="_blank" title="A data type representing a real decimal number or integer." href="https://psyteachr.github.io/glossary/n#numeric">numeric</a> variable, it will produce an error.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers2</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = c("id", "city", "postcode")</code></pre>
<pre><code>## Error in `inner_join()`:
## ! Can't join on `x$id` x `y$id` because of incompatible types.
## i `x$id` is of type &lt;integer&gt;&gt;.
## i `y$id` is of type &lt;character&gt;&gt;.</code></pre>
<p>The same goes for <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code>:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">customers</span>, <span class="va">new_customers2</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in `bind_rows()`:
## ! Can't combine `..1$id` &lt;integer&gt; and `..2$id` &lt;character&gt;.</code></pre>
<p>One method to change variable types is to use the <code>as.***</code> functions. If you type <code>as.</code> into a code chunk, you will see that there are a huge number of these functions for transforming variables and datasets to different types. Exactly which one you need will depend on the data you have, but a few commonly used ones are:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> - convert a variable to <a class="glossary" target="_blank" title="A data type representing a real decimal number or integer." href="https://psyteachr.github.io/glossary/n#numeric">numeric</a>. Useful for when you have a variable of real numbers that have been encoded as character. Any values that can't be turned into numbers (e.g., if you have the word "missing" in cells that you have no data for), will be returned as <code>NA</code>.</li>
<li>
<code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> - convert a variable to a <a class="glossary" target="_blank" title="A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter" href="https://psyteachr.github.io/glossary/f#factor">factor</a>. You can set the factor levels and labels manually, or use the default order (alphabetical).</li>
<li>
<code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> - convert a variable to <a class="glossary" target="_blank" title="A data type representing strings of text." href="https://psyteachr.github.io/glossary/c#character">character</a> data.</li>
<li>
<code><a href="https://tibble.tidyverse.org/reference/deprecated.html">as.tibble()</a></code> and <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> - convert a list object (not a variable) to a tibble or a data frame (two different table formats). This isn't actually relevant to what we're discussing here, but it's a useful one to be aware of because sometimes you'll run into issues where you get an error that specifically requests your data is a tibble or data frame type and you can use this function to overwrite your object.</li>
</ul>
<p>To use these functions on a variable we can use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to overwrite the variable with that variable as the new data type:</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_customers2</span> <span class="op">&lt;-</span> <span class="va">new_customers2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once you've done this, the joins will now work:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">orders</span>, <span class="va">new_customers2</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = "id"</code></pre>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
items
</th>
<th style="text-align:left;">
postcode
</th>
<th style="text-align:left;">
city
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:left;">
Tobermory
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
PA75 6NR
</td>
<td style="text-align:left;">
Tobermory
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:left;">
Falkirk
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
FK1 4RS
</td>
<td style="text-align:left;">
Falkirk
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
PA42 7EA
</td>
<td style="text-align:left;">
Ardbeg
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="glossary-3-2" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Glossary<a class="anchor" aria-label="anchor" href="#glossary-3-2"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/b.html#base-r" class="glossary" target="_blank">base r</a>
</td>
<td style="text-align:left;">
The set of R functions that come with a basic installation of R, before you add external packages.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/b.html#binding-joins" class="glossary" target="_blank">binding joins</a>
</td>
<td style="text-align:left;">
Joins that bind one table to another by adding their rows or columns together.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/c.html#character" class="glossary" target="_blank">character</a>
</td>
<td style="text-align:left;">
A data type representing strings of text.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/f.html#factor" class="glossary" target="_blank">factor</a>
</td>
<td style="text-align:left;">
A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/f.html#filtering-joins" class="glossary" target="_blank">filtering joins</a>
</td>
<td style="text-align:left;">
Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/m.html#mutating-joins" class="glossary" target="_blank">mutating joins</a>
</td>
<td style="text-align:left;">
Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/n.html#numeric" class="glossary" target="_blank">numeric</a>
</td>
<td style="text-align:left;">
A data type representing a real decimal number or integer.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/s.html#set-operations" class="glossary" target="_blank">set operations</a>
</td>
<td style="text-align:left;">
Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="resources-3-2" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Further resources<a class="anchor" aria-label="anchor" href="#resources-3-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheatsheet</a></li>
<li>
<a href="http://r4ds.had.co.nz/relational-data.html">Chapter 13: Relational Data</a> in <em>R for Data Science</em>
</li>
</ul>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="session-3-1.html"><span class="header-section-number">7</span> Session 3.1</a></div>
<div class="next"><a href="session-4-1.html"><span class="header-section-number">9</span> Session 4.1</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#session-3-2"><span class="header-section-number">8</span> Session 3.2</a></li>
<li><a class="nav-link" href="#set-up-3"><span class="header-section-number">8.1</span> Set-up</a></li>
<li><a class="nav-link" href="#joins-data"><span class="header-section-number">8.2</span> Loading data</a></li>
<li>
<a class="nav-link" href="#mutating-joins"><span class="header-section-number">8.3</span> Mutating Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#left_join"><span class="header-section-number">8.3.1</span> left_join()</a></li>
<li><a class="nav-link" href="#right_join"><span class="header-section-number">8.3.2</span> right_join()</a></li>
<li><a class="nav-link" href="#inner_join"><span class="header-section-number">8.3.3</span> inner_join()</a></li>
<li><a class="nav-link" href="#full_join"><span class="header-section-number">8.3.4</span> full_join()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filtering-joins"><span class="header-section-number">8.4</span> Filtering Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#semi_join"><span class="header-section-number">8.4.1</span> semi_join()</a></li>
<li><a class="nav-link" href="#anti_join"><span class="header-section-number">8.4.2</span> anti_join()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#multiple-joins"><span class="header-section-number">8.5</span> Multiple joins</a></li>
<li>
<a class="nav-link" href="#binding-joins"><span class="header-section-number">8.6</span> Binding Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bind_rows"><span class="header-section-number">8.6.1</span> bind_rows()</a></li>
<li><a class="nav-link" href="#bind_cols"><span class="header-section-number">8.6.2</span> bind_cols()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#set-operations"><span class="header-section-number">8.7</span> Set Operations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#intersect"><span class="header-section-number">8.7.1</span> intersect()</a></li>
<li><a class="nav-link" href="#union"><span class="header-section-number">8.7.2</span> union()</a></li>
<li><a class="nav-link" href="#setdiff"><span class="header-section-number">8.7.3</span> setdiff()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#conflicting-variable-types"><span class="header-section-number">8.8</span> Conflicting variable types</a></li>
<li><a class="nav-link" href="#glossary-3-2"><span class="header-section-number">8.9</span> Glossary</a></li>
<li><a class="nav-link" href="#resources-3-2"><span class="header-section-number">8.10</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/template/blob/master/book/08-session3.2.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/template/edit/master/book/08-session3.2.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Intro to R workshop</strong>" was written by Emily Nordmann. It was last built on 2022-07-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
